{"ast":null,"code":"import _regeneratorRuntime from\"/home/saad/Desktop/my-projects/contacts-app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/saad/Desktop/my-projects/contacts-app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/saad/Desktop/my-projects/contacts-app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from\"react\";import axios from\"axios\";import AuthContext from\"./authContext\";import authReducer from\"./authReducer\";import setAuthenticationToken from\"../../utilities/setAuthenticationToken\";import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from\"../types\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),isAuthenticated:null,user:null,error:null,loading:true};// dispatching functions\nvar _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// load user data\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// load token into global headers\nsetAuthenticationToken(localStorage.token);_context.prev=1;_context.next=4;return axios.get(\"/api/auth\");case 4:response=_context.sent;// if user exists\ndispatch({type:USER_LOADED,payload:response.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();// register user\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context2.prev=1;_context2.next=4;return axios.post(\"/api/users\",formData,config);case 4:response=_context2.sent;// if registration successful\ndispatch({type:REGISTER_SUCCESS,payload:response.data});// load user data\nloadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);// if registration failed\ndispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.message});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();// login\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return axios.post(\"/api/auth\",formData,config);case 4:response=_context3.sent;// if registration successful\ndispatch({type:LOGIN_SUCCESS,payload:response.data});// load user data\nloadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);// if registration failed\ndispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.message});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();// logout\nvar logout=function logout(){return dispatch({type:LOGOUT});};// clear errors\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,loadUser:loadUser,register:register,login:login,logout:logout,clearErrors:clearErrors},children:props.children});};export default AuthState;","map":{"version":3,"sources":["/home/saad/Desktop/my-projects/contacts-app/client/src/context/authentication/AuthState.js"],"names":["React","useReducer","axios","AuthContext","authReducer","setAuthenticationToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","user","error","loading","state","dispatch","loadUser","get","response","type","payload","data","register","formData","config","headers","post","message","login","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from \"react\";\nimport axios from \"axios\";\nimport AuthContext from \"./authContext\";\nimport authReducer from \"./authReducer\";\nimport setAuthenticationToken from \"../../utilities/setAuthenticationToken\";\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS,\n} from \"../types\";\n\nconst AuthState = props => {\n  const initialState = {\n    token: localStorage.getItem(\"token\"),\n    isAuthenticated: null,\n    user: null,\n    error: null,\n    loading: true,\n  };\n\n  // dispatching functions\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // load user data\n  const loadUser = async () => {\n    // load token into global headers\n    setAuthenticationToken(localStorage.token);\n    try {\n      const response = await axios.get(\"/api/auth\");\n      // if user exists\n      dispatch({ type: USER_LOADED, payload: response.data });\n    } catch (err) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n\n  // register user\n  const register = async formData => {\n    const config = { headers: { \"Content-Type\": \"application/json\" } };\n    try {\n      const response = await axios.post(\"/api/users\", formData, config);\n      // if registration successful\n      dispatch({ type: REGISTER_SUCCESS, payload: response.data });\n      // load user data\n      loadUser();\n    } catch (err) {\n      // if registration failed\n      dispatch({ type: REGISTER_FAIL, payload: err.response.data.message });\n    }\n  };\n\n  // login\n  const login = async formData => {\n    const config = { headers: { \"Content-Type\": \"application/json\" } };\n    try {\n      const response = await axios.post(\"/api/auth\", formData, config);\n      // if registration successful\n      dispatch({ type: LOGIN_SUCCESS, payload: response.data });\n      // load user data\n      loadUser();\n    } catch (err) {\n      // if registration failed\n      dispatch({ type: LOGIN_FAIL, payload: err.response.data.message });\n    }\n  };\n\n  // logout\n  const logout = () => dispatch({ type: LOGOUT });\n\n  // clear errors\n  const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        loading: state.loading,\n        user: state.user,\n        error: state.error,\n        loadUser,\n        register,\n        login,\n        logout,\n        clearErrors,\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}